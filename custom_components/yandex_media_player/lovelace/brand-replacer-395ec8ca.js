class t{static insert(e,i){if(!window||!document||!("MutationObserver"in window))return void console.warn("The runtime environment is not supported.");let n=t.INSTANCE;n||(n=new t,t.INSTANCE=n),n._watch(e,i)}static async waitShadowRoot(t,e=2e3){return t.shadowRoot?t.shadowRoot:new Promise(((i,n)=>{const o=t.attachShadow;let a=!1;const s=setTimeout((()=>{a=!0,n(new DOMException("Timeout","TimeoutError"))}),e);t.attachShadow=e=>(clearTimeout(s),a||setTimeout((()=>i(t.shadowRoot))),o.call(t,e))}))}static async waitElement(e,i,n=!1,o=2e3){if(!e)throw new Error("Target element not provided");if(!i)throw new Error("No selector provided");let a;a=n?await t.waitShadowRoot(e):e;const s=a.querySelector(i);return s||new Promise(((t,e)=>{let n;const s=new MutationObserver((()=>{const e=a.querySelector(i);if(e)return n&&clearTimeout(n),s.disconnect(),t(e)}));s.observe(a,{subtree:!0,childList:!0}),n=setTimeout((()=>{s.disconnect(),e(new Error("No element found"))}),o)}))}static findNode(t,e){for(const i of t.values())if(i.nodeName===e)return i}constructor(){this._initialized=!1,this._watchedImages={}}_watch(t,e){this._watchedImages[t]=e,this._initialized?(this._handleIntegrationsSettingsPage(),this._handleIntegrationsSettingsPage()):this._init()}_init(){this._initialized||(this._initialized=!0,t.waitElement(document.body,"home-assistant").then((e=>(t.waitShadowRoot(e).then((t=>{new MutationObserver(this._watchAddIntegrationDialogOpen.bind(this)).observe(t,{subtree:!0,childList:!0})})),t.waitElement(e,"home-assistant-main",!0)))).then((e=>t.waitElement(e,"ha-drawer",!0))).then((t=>{const e=t.querySelector("ha-config-integrations");e&&(this._configIntegrations=e,this._handleIntegrationsSettingsPage());new MutationObserver(this._watchConfigIntegrationsPage.bind(this)).observe(t,{subtree:!0,childList:!0})})).catch(console.error))}_watchConfigIntegrationsPage(e){for(let i=e.length-1;i>=0;i--){const n=e[i],o=t.findNode(n.addedNodes,"HA-CONFIG-INTEGRATIONS");o?(this._configIntegrations=o,this._handleIntegrationsSettingsPage()):t.findNode(n.removedNodes,"HA-CONFIG-INTEGRATIONS")&&(this._configIntegrations=void 0)}}_watchAddIntegrationDialogOpen(e){for(let i=e.length-1;i>=0;i--){const n=e[i],o=t.findNode(n.addedNodes,"DIALOG-ADD-INTEGRATION");o?(this._dialogAddIntegration=o,this._handleDialogAddIntegration()):t.findNode(n.removedNodes,"DIALOG-ADD-INTEGRATION")&&(this._dialogAddIntegration=void 0,this._dialogIntegrationListObserver&&(this._dialogIntegrationListObserver.disconnect(),this._dialogIntegrationListObserver=void 0))}}_dialogIntegrationListMutationCallback(e){var i;for(let n=0;n<e.length;n++){const o=e[n],a=t.findNode(o.addedNodes,"HA-INTEGRATION-LIST-ITEM");a&&(null===(i=a.__integration)||void 0===i?void 0:i.domain)in this._watchedImages&&this._replaceImageDialogAddIntegration(a,a.__integration.domain)}}_handleIntegrationsSettingsPage(){this._configIntegrations&&t.waitElement(this._configIntegrations,"ha-config-integrations-dashboard").then((e=>t.waitElement(e,"hass-tabs-subpage",!0))).then((e=>t.waitElement(e,".container"))).then((t=>{for(let e=0;e<t.children.length;e++){const i=t.children.item(e),n=i.dataset.domain;n&&(n in this._watchedImages&&this._replaceImageIntegrationCard(i,n))}})).catch(console.error)}_handleDialogAddIntegration(){this._dialogAddIntegration&&t.waitElement(this._dialogAddIntegration,"ha-dialog",!0).then((e=>t.waitElement(e,"mwc-list"))).then((t=>{this._dialogIntegrationListObserver=new MutationObserver(this._dialogIntegrationListMutationCallback.bind(this)),this._dialogIntegrationListObserver.observe(t,{subtree:!0,childList:!0})})).catch(console.error)}_replaceImageIntegrationCard(e,i){t.waitElement(e,"ha-integration-header",!0).then((e=>t.waitElement(e,".header",!0))).then((e=>t.waitElement(e,"img"))).then((t=>{t.src=this._watchedImages[i],t.style.visibility="visible"})).catch(console.error)}_replaceImageDialogAddIntegration(e,i){const n=this._watchedImages[i];t.waitElement(e,"span > img",!0).then((t=>{t.src=n,t.style.visibility="visible"})).catch(console.error)}}export{t as BrandReplacer};
