function t(t){return new Promise((e=>setTimeout(e,t)))}function e(e,n=3){let o=!1,i=50;return new Promise((async(a,s)=>{for(;;){let r;try{r=await e(),o||(a(r),o=!0);break}catch(t){if(o)break;if(n<=0){s(t),o=!0;break}n--}await t(i),i+=50}}))}class n{static insert(t,e){if(!window||!document||!("MutationObserver"in window))return void console.warn("The runtime environment is not supported.");let o=n.INSTANCE;o||(o=new n,n.INSTANCE=o),o._watch(t,e)}static getShadowRoot(t){return t.shadowRoot?Promise.resolve(t.shadowRoot):e((()=>{if(t.shadowRoot)return t.shadowRoot;throw new Error("No shadow root found")}),10)}static getElement(t,n){const o=t.querySelector(n);return o?Promise.resolve(o):e((()=>{const e=t.querySelector(n);if(e)return e;throw new Error(`No "${n}" element found`)}),10)}static findNode(t,e){for(const n of t.values())if(n.nodeName===e)return n}constructor(){this._initialized=!1,this._watchedImages={}}_watch(t,e){this._watchedImages[t]=e,this._initialized?(this._handleIntegrationsSettingsPage(),this._handleIntegrationsSettingsPage()):this._init()}_init(){this._initialized||(this._initialized=!0,n.getElement(document.body,"home-assistant").then((t=>n.getShadowRoot(t))).then((t=>(new MutationObserver(this._homeAssistantMutationCallback.bind(this)).observe(t,{subtree:!0,childList:!0}),n.getElement(t,"home-assistant-main")))).then((t=>{if(!t.shadowRoot)throw new Error("No shadow root in <home-assistant-main />");return n.getElement(t.shadowRoot,"ha-drawer")})).then((t=>{const e=t.querySelector("ha-config-integrations");e&&(this._configIntegrations=e,this._handleIntegrationsSettingsPage());new MutationObserver(this._drawerMutationCallback.bind(this)).observe(t,{subtree:!0,childList:!0})})).catch(console.error))}_drawerMutationCallback(t){for(let e=t.length-1;e>=0;e--){const o=t[e],i=n.findNode(o.addedNodes,"HA-CONFIG-INTEGRATIONS");i?(this._configIntegrations=i,this._handleIntegrationsSettingsPage()):n.findNode(o.removedNodes,"HA-CONFIG-INTEGRATIONS")&&(this._configIntegrations=void 0)}}_homeAssistantMutationCallback(t){for(let e=t.length-1;e>=0;e--){const o=t[e],i=n.findNode(o.addedNodes,"DIALOG-ADD-INTEGRATION");i?(this._dialogAddIntegration=i,this._handleDialogAddIntegration()):n.findNode(o.removedNodes,"DIALOG-ADD-INTEGRATION")&&(this._dialogAddIntegration=void 0,this._dialogIntegrationListObserver&&(this._dialogIntegrationListObserver.disconnect(),this._dialogIntegrationListObserver=void 0))}}_dialogIntegrationListMutationCallback(t){var e;for(let o=0;o<t.length;o++){const i=t[o],a=n.findNode(i.addedNodes,"HA-INTEGRATION-LIST-ITEM");a&&(null===(e=a.__integration)||void 0===e?void 0:e.domain)in this._watchedImages&&this._replaceImageDialogAddIntegration(a,a.__integration.domain)}}_handleIntegrationsSettingsPage(){this._configIntegrations&&n.getShadowRoot(this._configIntegrations).then((t=>n.getElement(t,"hass-tabs-subpage"))).then((t=>n.getElement(t,".container"))).then((t=>{if(t&&t.children.length)for(let e=0;e<t.children.length;e++){const n=t.children.item(e),o=n.domain;o in this._watchedImages&&this._replaceImageIntegrationCard(n,o)}else console.warn("Container is empty")})).catch(console.error)}_handleDialogAddIntegration(){this._dialogAddIntegration&&n.getShadowRoot(this._dialogAddIntegration).then((t=>n.getElement(t,"ha-dialog"))).then((t=>n.getElement(t,"mwc-list"))).then((t=>{this._dialogIntegrationListObserver=new MutationObserver(this._dialogIntegrationListMutationCallback.bind(this)),this._dialogIntegrationListObserver.observe(t,{subtree:!0,childList:!0})})).catch(console.error)}_replaceImageIntegrationCard(t,e){n.getShadowRoot(t).then((t=>n.getElement(t,"ha-card"))).then((t=>n.getElement(t,"ha-integration-header"))).then((t=>n.getShadowRoot(t))).then((t=>n.getElement(t,".header"))).then((t=>n.getElement(t,"img"))).then((t=>{t.src=this._watchedImages[e]})).catch(console.error)}_replaceImageDialogAddIntegration(t,e){const o=this._watchedImages[e];n.getShadowRoot(t).then((t=>n.getElement(t,"span > img"))).then((t=>{t.src=o})).catch(console.error)}}export{n as BrandReplacer};
